# Springì—ì„œì˜ ì˜ˆì™¸ ì²˜ë¦¬

Java ì§„ì˜ì˜ ì£¼ëœ ëª©í‘œ. ì›¹ ì„œë¹„ìŠ¤ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œëŠ” ì™¸ë¶€ì—ì„œ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì— ë‹´ê¸´ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ëŠ” ê²½ìš°ê°€ ì¦ìŒ.

ì´ ê³¼ì •ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ ëŒ€ë¶€ë¶„ì˜ ê²½ìš° ë³µêµ¬ë³´ë‹¤, í´ë¼ì´ì–¸íŠ¸ì— ë¬¸ì œ ìƒí™©ì— ëŒ€í•œ ì „ë‹¬ì„ í•˜ëŠ” ê²½ìš°ê°€ ë§ë‹¤.

- ìŠ¤í”„ë§ ë¶€íŠ¸ì—ì„œë„ ë§ˆì°¬ê°€ì§€..

**ì˜ˆì™¸ ë°œìƒ ì‹œ í´ë¼ì´ì–¸íŠ¸ì— ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ì „ë‹¬í•˜ë ¤ë©´ ê° ë ˆì´ì–´ì—ì„œ ë°œìƒí•œ ì˜ˆì™¸ë¥¼ ì—”ë“œí¬ì¸íŠ¸ ë ˆë²¨ì¸ ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ ì „ë‹¬í•´ì•¼ í•œë‹¤.**

ìŠ¤í”„ë§ ë¶€íŠ¸ì—ëŠ” ì´ë ‡ê²Œ ì „ë‹¬ë°›ì€ ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•˜ëŠ” ë‘ ê°€ì§€ ë°©ì‹ì´ ìˆë‹¤.

1. @ExceptionHandlerë¥¼ í†µí•´ íŠ¹ì • ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ì˜ˆì™¸ë¥¼ ì²˜ë¦¬
2. @(Rest)ControllerAdviceì™€ @ExceptionHandlerë¥¼ í†µí•´ ëª¨ë“  ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ì˜ˆì™¸ë¥¼ ì²˜ë¦¬

ê°„ë‹¨í•œ ë¹„êµë¥¼ í•˜ìë©´

- ë©”ì†Œë“œ ì˜ì—­ì˜ ì˜ˆì™¸ì²˜ë¦¬ â†’ try/catch
- í´ë˜ìŠ¤ ì˜ì—­ì˜ ì˜ˆì™¸ì²˜ë¦¬ â†’ @ExceptionHandler
- ì „ì—­ ì˜ì—­ì˜ ì˜ˆì™¸ì²˜ë¦¬ â†’ @ControllerAdvice + @ExceptionHandler

## 1. @ExceptionHandler ì–´ë…¸í…Œì´ì…˜ì„ í™œìš©í•˜ì—¬ êµ¬í˜„í•˜ëŠ” ë°©ë²•

`@ExceptionHandler`ë§Œ ì‚¬ìš©í•  ê²½ìš° â†’ ì»¨íŠ¸ë¡¤ëŸ¬ í´ë˜ìŠ¤ ë‚´ì—ì„œ êµ¬í˜„.

```java
@RestController
@RequestMapping("/person")
public class PersonController {
    @GetMapping
    public String test(){
        return "test";
    }

    @GetMapping("/exception")
    public String exception1(){
        throw new NullPointerException();
    }

    @ExceptionHandler(value = NullPointerException.class)
    public String nullPointerExceptionHandle(NullPointerException ex){
        return "nullPointerException Handle!!!";
    }
}
```

ë˜ëŠ”

```java
@RestController
@RequestMapping("/person")
public class PersonController {
    @GetMapping
    public String test(){
        return "test";
    }

    @GetMapping("/exception")
    public String exception1(){
        throw new NullPointerException();
    }

    @GetMapping("/exception2")
    public String exception2(){
        throw new ClassCastException();
    }

    @ExceptionHandler({NullPointerException.class, ClassCastException.class})
    public String handle(Exception ex){
        return "Exception Handle!!!";
    }
}
```

`@ExceptionHandler` í•˜ë‚˜ê°€ ë‹¤ìˆ˜ì˜ Exceptionì„ ì¡ì•„ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.

## 2. @ControllerAdvice, @ExceptionHandler ì–´ë…¸í…Œì´ì…˜ì„ í™œìš©í•˜ì—¬ êµ¬í˜„í•˜ëŠ” ë°©ë²•

<img width="669" alt="%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-11-16_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_2 38 06" src="https://github.com/inu-appcenter/server-study-15.5/assets/121238128/ca885ad5-0fe1-4d56-bde3-e071a3cb0959">

@Component ì–´ë…¸í…Œì´ì…˜ì´ ë¶™ì–´ìˆë‹¤. â‡’ ë¹ˆìœ¼ë¡œ ë“±ë¡/ê´€ë¦¬ëœë‹¤.

`@(Rest)ControllerAdvice`

- `@Controller`ë‚˜Â `@RestController`ì—ì„œ ë°œìƒí•œ ì˜ˆì™¸ë¥¼ í•œ ê³³ì—ì„œ ê´€ë¦¬í•˜ê³  ì²˜ë¦¬í•  ìˆ˜ ìˆê²Œ ë„ì™€ì£¼ëŠ” ì–´ë…¸í…Œì´ì…˜
- `try-catch`Â ë¥¼ í†µí•œ ì˜ˆì™¸ ì²˜ë¦¬ëŠ” ì½”ë“œë¼ì¸ë„ ê¸¸ì–´ì§€ê³  ê°€ë…ì„±ì´ ë–¨ì–´ì§ â†’ ë¶„ë¦¬

```java
@RestControllerAdvice(basePackages = "com.exapmple.com")
public class ControllerAdvice {
 
    @ExceptionHandler(UserDuplicatedException.class)
    @ResponseStatus(HttpStatus.BAD_REQUEST)
    public ErrorDto duplicate1(UserDuplicatedException e){
        return new ErrorDto(e.getMessage(),false);
    }
 
    @ExceptionHandler
    @ResponseStatus(HttpStatus.BAD_REQUEST)
    public ErrorDto duplicate2(UserDuplicatedException e){
        return new ErrorDto(e.getMessage(),false);
    }
}
```

`@(Rest)ControllerAdvice` í´ë˜ìŠ¤ê°€ ë°”ë¼ë³¼ ë²”ìœ„ ì§€ì •

```java
// Target all Controllers annotated with @RestController
@ControllerAdvice(annotations = RestController.class)
public class ExampleAdvice1 {}

// Target all Controllers within specific packages
@ControllerAdvice("org.example.controllers")
public class ExampleAdvice2 {}

// Target all Controllers assignable to specific classes
@ControllerAdvice(assignableTypes = {ControllerInterface.class, AbstractController.class})
public class ExampleAdvice3 {}
```

### ControllerAdvice, RestControllerAdviceì˜ ì°¨ì´

Docsì— ë”°ë¥´ë©´ `RestControllerAdvice = ControllerAdvice + ResponseBody`


<img width="692" alt="%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-11-16_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_2 37 44" src="https://github.com/inu-appcenter/server-study-15.5/assets/121238128/91f0dade-c227-4b6b-9fe1-e4bd002eb937">

`RestControllerAdvice` ë¡œ ì„ ì–¸í•˜ë©´ ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ë¦¬í„´ ê°’ì´ ì‘ë‹µì˜ bodyê°€ ë˜ì–´ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì „ë‹¬ëœë‹¤.

ì¦‰, `RestControllerAdvice`Â ëŠ” ë¦¬í„´ê°’ì„ ë°”ë¡œ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì „ë‹¬í•œë‹¤.

ë°˜ë©´ì—Â `ControllerAdvice`Â ëŠ” ë¦¬í„´ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ ë™ì¼í•œ ì´ë¦„ì˜ viewë¥¼ ì°¾ëŠ”ë‹¤.

<aside>
ğŸ’¡ @ControllerAdvice ëŒ€ì‹  @RestControllerAdviceë¥¼ ì‚¬ìš©í•˜ë©´ ê²°ê³¼ê°’ì„ JSON í˜•íƒœë¡œ ë°˜í™˜í•  ìˆ˜ ìˆë‹¤.

</aside>

### ControllerAdvice ë‚´ ìš°ì„  ìˆœìœ„

@ControllerAdviceì™€ í´ë˜ìŠ¤ ìˆ˜ì¤€ì˜ @ExceptionHandler â‡’ @ExceptionHandler ì‹¤í–‰ (ìš°ì„ ìˆœìœ„ê°€ ë” ë†’ìŒ)

**ê¸°ë³¸ì ìœ¼ë¡œ ìš°ì„ ìˆœìœ„ëŠ” ì¡°ê¸ˆ ë” specificí•œ ìª½ì´ ë” ë†’ë‹¤!**

â†’ Exception.class ì²˜ë¦¬í•˜ëŠ” í•¸ë“¤ëŸ¬ < NullPointerException.class ì²˜ë¦¬í•˜ëŠ” í•¸ë“¤ëŸ¬

â†’ @ControllerAdviceì˜ í•¸ë“¤ëŸ¬ < ì»¨íŠ¸ë¡¤ëŸ¬ ë‚´ @ExceptionHandler

ì—¬ëŸ¬ ê°œì˜ @ControllerAdvice í´ë˜ìŠ¤ë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ì—¬ ì‚¬ìš©í•œë‹¤ë©´ Advice í´ë˜ìŠ¤ ì‚¬ì´ ìš°ì„ ìˆœìœ„ëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

1. Ordered ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„. 
    
    <img width="668" alt="%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-11-16_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_3 36 08" src="https://github.com/inu-appcenter/server-study-15.5/assets/121238128/0debf977-61a1-45eb-8aff-dfe61595ed51">
    
2. @Order ë¥¼ í†µí•´ ì„ ì–¸ëœ ìš°ì„ ìˆœìœ„
    
    <img width="975" alt="%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-11-16_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_3 38 26" src="https://github.com/inu-appcenter/server-study-15.5/assets/121238128/205ed53a-803d-4fcd-959a-ff9106ff78a4">
    
    <img width="626" alt="%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-11-16_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_3 37 46" src="https://github.com/inu-appcenter/server-study-15.5/assets/121238128/f509a6a8-b9b9-41d6-b025-ba1f955f84ee">

    <img width="654" alt="%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-11-16_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_3 38 10" src="https://github.com/inu-appcenter/server-study-15.5/assets/121238128/376e049e-9624-4fe6-900d-4d4feeee8c48">
    
    <img width="1395" alt="%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-11-16_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_3 32 50" src="https://github.com/inu-appcenter/server-study-15.5/assets/121238128/e3a9207a-fa3f-48b1-80da-ffaee5881b0f">
    
    Lower Value has Higher Priority
    

> `[@Order](https://docs.spring.io/spring-framework/docs/4.3.22.RELEASE_to_4.3.23.RELEASE/Spring%20Framework%204.3.23.RELEASE/org/springframework/core/annotation/Order.html)`Â andÂ `[Ordered](https://docs.spring.io/spring-framework/docs/4.3.22.RELEASE_to_4.3.23.RELEASE/Spring%20Framework%204.3.23.RELEASE/org/springframework/core/Ordered.html)`, and applied in that order at runtime. For handling exceptions, anÂ `@ExceptionHandler`Â will be picked on the first advice with a matching exception handler method. For model attributes andÂ `InitBinder`Â initialization,Â `@ModelAttribute`Â andÂ `@InitBinder`Â methods will also followÂ `@ControllerAdvice`Â order.
> 

<aside>
ğŸ’¡ ê¸°ë³¸ì ìœ¼ë¡œ @ControllerAdviceì˜ ë©”ì„œë“œëŠ” ëª¨ë“  ì»¨íŠ¸ë¡¤ëŸ¬ì— ì „ì—­ì ìœ¼ë¡œ ì ìš©ëœë‹¤.
ì–´ë…¸í…Œì´ì…˜ì´ë‚˜  basePackageClasses ë° basePackages(ë˜ëŠ” í•´ë‹¹ ë³„ì¹­ ê°’)ì™€ ê°™ì€ selectorë¥¼ ì‚¬ìš©í•˜ì—¬ ëŒ€ìƒ ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ë³´ë‹¤ ì¢ì€ í•˜ìœ„ ì§‘í•©ì„ ì •ì˜í•  ìˆ˜ ìˆë‹¤.
Selectorê°€ ì—¬ëŸ¬ ê°œ ì„ ì–¸ë˜ë©´ ë¶€ìš¸ OR ë…¼ë¦¬ê°€ ì ìš©ë˜ê³  ì„ íƒëœ ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ì ì–´ë„ í•˜ë‚˜ì˜ Selectorì™€ ì¼ì¹˜í•´ì•¼ í•œë‹¤.
Selector ê²€ì‚¬ëŠ” ëŸ°íƒ€ì„ì— ìˆ˜í–‰ë˜ë¯€ë¡œ Selectorê°€ ë§ì•„ì§€ë©´ ì„±ëŠ¥ ìƒ ì¢‹ì§€ì•Šë‹¤.

![Untitled](https://github.com/inu-appcenter/server-study-15.5/assets/121238128/ed5eb3e6-f0cc-431f-96a3-36abee96ebe9)

[Docs - @ControllerAdvice](https://docs.spring.io/spring-framework/docs/4.3.22.RELEASE_to_4.3.23.RELEASE/Spring%20Framework%204.3.23.RELEASE/org/springframework/web/bind/annotation/ControllerAdvice.html)

</aside>